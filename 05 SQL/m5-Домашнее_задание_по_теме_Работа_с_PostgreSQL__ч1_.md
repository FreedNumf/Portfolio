**Модуль 5. Домашнее задание по теме «Работа с PostgreSQL» (часть 1)**

**Цель домашнего задания:**
закрепить навыки работы с оконными функциями, табличными выражениями и подзапросами.

**Перечень заданий**

**Основная часть:**
Задание 1. Сделайте запрос к таблице payment и с помощью оконных функций добавьте вычисляемые колонки согласно условиям:

- Пронумеруйте все платежи от 1 до N по дате платежа
- Пронумеруйте платежи для каждого покупателя, сортировка платежей должна быть по дате платежа
- Посчитайте нарастающим итогом сумму всех платежей для каждого покупателя, сортировка должна быть сперва по дате платежа, а затем по размеру платежа от наименьшей к большей
- Пронумеруйте платежи для каждого покупателя по размеру платежа от наибольшего к меньшему так, чтобы платежи с одинаковым значением имели одинаковое значение номера.
  Можно составить на каждый пункт отдельный SQL-запрос, а можно объединить все колонки в одном запросе.
  Ожидаемый результат запроса: [letsdocode.ru...in/5-1.png](https://letsdocode.ru/sql-main/5-1.png)

Задание 2. С помощью оконной функции выведите для каждого покупателя стоимость платежа и стоимость платежа из предыдущей строки со значением по умолчанию 0.0 с сортировкой по дате платежа.
Ожидаемый результат запроса: [letsdocode.ru...in/5-2.png](https://letsdocode.ru/sql-main/5-2.png)

Задание 3. С помощью оконной функции определите, на сколько каждый следующий платеж покупателя больше или меньше текущего.
Ожидаемый результат запроса: [letsdocode.ru...in/5-3.png](https://letsdocode.ru/sql-main/5-3.png)

Задание 4. С помощью оконной функции для каждого покупателя выведите данные о его последней оплате аренды.
Ожидаемый результат запроса: [letsdocode.ru...in/5-4.png](https://letsdocode.ru/sql-main/5-4.png)

**Дополнительная часть:**

Задание 1. С помощью оконной функции выведите для каждого сотрудника сумму продаж за август 2005 года с нарастающим итогом по каждому сотруднику и по каждой дате продажи (без учёта времени) с сортировкой по дате.
Ожидаемый результат запроса: [letsdocode.ru...in/5-5.png](https://letsdocode.ru/sql-main/5-5.png)

Задание 2. 20 августа 2005 года в магазинах проходила акция: покупатель каждого сотого платежа получал дополнительную скидку на следующую аренду. С помощью оконной функции выведите всех покупателей, которые в день проведения акции получили скидку.
Ожидаемый результат запроса: [letsdocode.ru...in/5-6.png](https://letsdocode.ru/sql-main/5-6.png)

Задание 3. Для каждой страны определите и выведите одним SQL-запросом покупателей, которые попадают под условия:
· покупатель, арендовавший наибольшее количество фильмов;
· покупатель, арендовавший фильмов на самую большую сумму;
· покупатель, который последним арендовал фильм.
Ожидаемый результат запроса: [letsdocode.ru...in/5-7.png](https://letsdocode.ru/sql-main/5-7.png)

