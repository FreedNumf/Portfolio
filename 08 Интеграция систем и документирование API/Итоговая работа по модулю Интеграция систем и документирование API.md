**Контекст**

Кинотеатр “Искорка”, для которого вы ранее разработали многофункциональный API, планирует запустить бонусную программу для постоянных посетителей.

Условия заказчика:

1. Участие в бонусной программе необязательно, при желании посетитель может оформить бонусную карту.
1. Если клиент указывает при бронировании номер карты, то 10% стоимости бронирования зачисляется на карту в виде бонусных баллов (1 балл = 1 рубль).
1. Баллы начисляются автоматически сразу после оплаты брони.
1. При бронировании клиент может оплачивать до 50% стоимости билетов бонусными баллами.
1. Также руководство кинотеатра ставит задачу - представлять ежемесячный отчет:
- как часто клиенты используют бонусную карту при бронировании
- какую часть стоимости билетов (%) клиенты оплачивают бонусными баллами

**Задание**

1. Какие изменения потребуется внести в существующие структуры данных для решения задачи?

Дайте ответ в таком формате:

**Наименование структуры (расшифровка по-русски)**

|**Имя**|**Тип**|**Описание поля**|
| :- | :- | :- |
|show\_id|integer|id показа|
|show\_name|string|наименование фильма|

2. Требуется ли добавление новых таблиц для решения задачи? Если да, то каких?
   Используйте формат ответа из п.1
2. Какие изменения потребуется внести в существующие методы API для решения задачи?
2. Требуется ли создание новых методов?
2. Если да, опишите новые методы, указав:
- описание метода (в описании укажите какую задачу он выполняет)
- ресурс
- метод HTTP
- параметры запроса
- параметры ответа

**Решение**

[**Решение в Swagger**](https://app.swaggerhub.com/apis/YoFrost/API_Iskorka/1.0.2)

1. Какие изменения потребуется внести в существующие структуры данных для решения задачи?

|Имя|Тип|Описание поля|
| :- | :- | :- |
|film\_title|string|Название фильма|
|start\_time|string (datetime)|Время начала сеанса|
|duration|integer|Продолжительность сеанса|
|available\_seats|integer|Количество доступных мест на сеансе|
|session\_id|integer|Уникальный идентификатор сеанса (первичный ключ)|

**Сеансы/session**


**Бронирование/reservation**

|Имя|Тип|Описание поля|
| :- | :- | :- |
|reservation\_id|integer|Уникальный идентификатор брони (первичный ключ|
|session\_id|integer|Идентификатор сеанса (внешний ключ, связывает с таблицей “Сеансы”)|
|customer\_name|string|Имя покупателя|
|seat\_number|integer|Номер забронированного места|
|bonus\_card\_number|string|Номер бонусной карты (если используется)|
|paid\_with\_bonus\_points|integer|Количество баллов, использованных при покупке|


1. Требуется ли добавление новых таблиц для решения задачи? Если да, то каких?

**Новые таблицы:**

**Бонусные Карты (BonusCards):**

|<a name="_hlk162729009"></a>Имя|Тип|Описание поля|
| :- | :- | :- |
|bonus\_card\_number|string|Уникальный номер бонусной карты|
|user\_id|integer|Идентификатор пользователя|
|bonus\_points|integer|Количество бонусных баллов|

**История Бонусных Баллов (BonusPointsHistory):**

|Имя|Тип|Описание поля|
| :- | :- | :- |
|record\_id|integer|Уникальный идентификатор записи|
|bonus\_card\_number|string|Номер бонусной карты|
|change\_amount|integer|Величина изменения баллов|
|change\_date|timestamp|Дата и время изменения баллов|
|change\_type|string|Тип изменения (например, “начисление”, “списание”)|


1. Какие изменения потребуется внести в существующие методы API для решения задачи?

**Изменения в методах API:**

- **POST /reservations** – добавить параметры bonus\_card\_number и use\_bonus\_points.
- **PUT /reservations/{reservation\_id}** - обновить для обработки изменений бронирования с использованием бонусных баллов.

1. Требуется ли создание новых методов?
- **POST /bonus-cards** - создание бонусной карты.
- **POST /bonus-points/use** - использование бонусных баллов для оплаты бронирования.
- **GET /bonus-points/history** - получение истории изменений бонусных баллов.
- **GET /reports/bonus-card-usage** - получение отчета о использовании бонусных карт.


1. Если да, опишите новые методы, указав:
- описание метода (в описании укажите какую задачу он выполняет)
- ресурс
- метод HTTP
- параметры запроса
- параметры ответа

**Изменения в существующих методах API:**

1. **POST /reservations** - метод для создания бронирования.

   **Добавление параметров:**

   1. bonus\_card\_number (string): Номер бонусной карты пользователя.
   1. use\_bonus\_points (integer): Количество бонусных баллов, которые пользователь хочет использовать для оплаты бронирования.

**Новые методы API:**

1. **PUT /reservations/{reservation\_id}** - метод для обновления информации о бронировании.

   **Описание метода:** Обновление бронирования.

   **Ресурс:** /reservation

   **Метод HTTP:** PUT

   **Параметры запроса:**

   1. reservation\_id (integer) - Идентификатор брони, которую нужно обновить

**Параметры ответа:**

1. **Код 200 (OK)** с информацией об успешной отмене брони

1. **POST /bonus-cards** - метод для регистрации бонусной карты пользователя.

   **Описание метода:** Регистрация новой бонусной карты и начисление начальных бонусных баллов.

   **Ресурс:** /bonus-cards

   **Метод HTTP:** POST

   **Параметры запроса:**

   1. user\_id (integer): Идентификатор пользователя.

**Параметры ответа:**

`    `**Код 200 (OK)** 

1. bonus\_card\_number (string): Номер созданной бонусной карты.
1. bonus\_points (integer): Количество начисленных бонусных баллов.

1. **POST /bonus-points/use** - метод для использования бонусных баллов при бронировании.

   **Описание метода: Использование бонусных баллов для оплаты части стоимости билетов.**

   **Ресурс: /**bonus-points/use

   **Метод HTTP: POST**

   **Параметры запроса:**

   1. reservation\_id (integer): Идентификатор бронирования.
   1. points\_used (integer): Количество бонусных баллов, которые пользователь хочет использовать.

**Параметры ответа:**

1. **Код 200 (OK)** new\_bonus\_points (integer): Обновленное количество бонусных баллов пользователя после использования.

1. **GET /bonus-points/history** - метод для получения истории изменений бонусных баллов пользователя.

   **Описание метода: Получение истории всех транзакций по бонусным баллам пользователя.**

   **Ресурс:** /bonus-points/history

   **Метод HTTP: GET**

   **Параметры запроса:**

   1. bonus\_card\_number (string): Номер бонусной карты пользователя.

**Параметры ответа:**

1. **Код 200 (OK)** Массив объектов, содержащих информацию о каждой транзакции (начисление или списание баллов).

1. **GET /reports/bonus-card-usage** - метод для получения отчета о использовании бонусных карт.

   **Описание метода: Получение ежемесячного отчета о использовании бонусных карт пользователями.**

   **Ресурс:** /reports/bonus-card-usage

   **Метод HTTP: GET**

   **Параметры запроса:**

   1. start\_date (string): Начальная дата отчетного периода.
   1. end\_date (string): Конечная дата отчетного периода.

**Параметры ответа:**

1. **Код 200 (OK)** Отчет, содержащий статистику использования бонусных карт, включая количество использований и процент оплаты билетов бонусными баллами.
